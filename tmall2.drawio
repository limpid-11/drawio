<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36 Edg/127.0.0.0" version="24.7.6">
  <diagram name="第 1 页" id="36jbz5RrVT9zZQwFr1fX">
    <mxGraphModel dx="1445" dy="1952" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="ATmWsD3FDVk_h2czRpAP-1" value="&lt;div&gt;spark = SparkSession.builder&lt;span style=&quot;background-color: initial;&quot;&gt;.appName(&quot;tmall&quot;) \&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .config(&quot;master&quot;, &quot;local[*]&quot;) \&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .enableHiveSupport() \&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; .getOrCreate()&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;# 初始化Spark&lt;/div&gt;&lt;div&gt;sc = spark.sparkContext&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;# 初始化Spark上下文&lt;br&gt;&lt;/div&gt;&lt;div&gt;sqlContest = SQLContext(sc)&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;# 初始化SQL上下文&lt;br&gt;&lt;/div&gt;&lt;div&gt;sqlContest.createDataFrame(df,scheme)&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;# 创建SQL表格&lt;br&gt;&lt;/div&gt;&lt;div&gt;feat_builder = FeaturesBuilder(user_log)&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;# 基于表格建立特征提取器&lt;br&gt;&lt;/div&gt;&lt;div&gt;user_log.filter(user_log[&#39;x&#39;].isin([1110]))&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;# 筛选函数&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" parent="1" vertex="1">
          <mxGeometry x="-220" y="-170" width="430" height="210" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-2" value="pyspark函数一览" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-220" y="-200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-3" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" parent="1" vertex="1">
          <mxGeometry x="220" y="-170" width="430" height="210" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-4" value="特征提取的流程" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="220" y="-200" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-5" value="新定义的特征" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="220" y="50" width="80" height="30" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-6" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" parent="1" vertex="1">
          <mxGeometry x="220" y="80" width="430" height="210" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-8" value="&lt;div&gt;&lt;b&gt;概念&lt;/b&gt;&lt;/div&gt;&lt;div&gt;召回：候选集规模大、模型和特征简单、速度快，尽量保证用户感兴趣数据多召回。&lt;/div&gt;&lt;div&gt;排序：候选集不大，目标是保证排序的精准，一般使用复杂和模型和特征。&lt;/div&gt;&lt;div&gt;多路召回：既要用户感兴趣，又要时效热点，考虑分成多路召回&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;发展&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000cc&quot;&gt;传统召回：协同过滤（考虑用户之间或者是物品之间的相似性来进行喜好预测）&lt;/font&gt;&lt;/div&gt;&lt;div&gt;1）基于用户&lt;/div&gt;&lt;div&gt;缺点：计算存储开销大、稀疏用户效果不佳&lt;/div&gt;&lt;div&gt;适合于新闻推荐（兴趣点分散，且群体特征强）&lt;/div&gt;&lt;div&gt;2）基于物品&lt;/div&gt;&lt;div&gt;适合于商品或是视频推荐（兴趣较为稳定）&lt;/div&gt;&lt;div&gt;3）矩阵分解&lt;br&gt;&lt;/div&gt;&lt;div&gt;缺点：计算开销大O(mn&lt;sup&gt;2&lt;/sup&gt;)，对稀疏矩阵的分解效果不好&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000cc&quot;&gt;基于embedding的召回框架&lt;/font&gt;&lt;/div&gt;&lt;div&gt;1）i2i召回框架&lt;/div&gt;&lt;div&gt;离线建立item的embedding模型，在线进行相似度的计算并推荐&lt;/div&gt;&lt;div&gt;2）u2i召回框架&lt;/div&gt;&lt;div&gt;离线计算item与user的&lt;span style=&quot;background-color: initial;&quot;&gt;embedding模型，在线直接基于user&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;embedding进行推荐&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#ff3399&quot;&gt;1）基于内容语义的i2i召回 （序列）&lt;/font&gt;&lt;/div&gt;&lt;div&gt;Item2vec：item点击序列+Word2vec得到item的embedding (&lt;span style=&quot;background-color: initial;&quot;&gt;Item2vec&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;摒弃了时间窗口，认为序列中都具有相关性)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Bert方法：仅针对MLM进行embedding，无position和segment，使用&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;Item2vec的embedding代替&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#ff3399&quot;&gt;2）基于Graph embedding的i2i召回 （图）&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;图结构引入了更加复杂的关系，打破了时间点击序列的独立性&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;（1）DeepWalk&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;随机游走，根据每条路的权重计算走每条路的概率&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;（2）EGES&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;融合item多项属性的embedding得到item的最终embedding，解决了item的冷启动问题&lt;/span&gt;&lt;/div&gt;&lt;div&gt;（3）Node2vec&lt;/div&gt;&lt;div&gt;使用两个参数P（返回参数）Q（出入参数）控制游走的策略，倾向于探索同质性的BFS/结构性的DFS&lt;/div&gt;&lt;div&gt;（4）GCN&lt;/div&gt;&lt;div&gt;太难了，先放一下&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(255, 51, 153);&quot;&gt;3）基于深度学习的u2i召回 （深度）&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;（1）DSSM（Deep Structured Semantic Models）&lt;/div&gt;&lt;div&gt;user侧和item侧分别计算embedding，可以离线训练，使用时在线计算相似度即可&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" parent="1" vertex="1">
          <mxGeometry x="-640" y="-920" width="700" height="580" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-10" value="&lt;div&gt;&lt;b&gt;相似度的计算&lt;/b&gt;&lt;/div&gt;&lt;div&gt;1）Jaccard距离（交并集）&lt;/div&gt;&lt;div&gt;2）欧氏距离&lt;/div&gt;&lt;div&gt;3）余弦相似度&lt;/div&gt;&lt;div&gt;4）皮尔逊相关系数&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;...&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" parent="1" vertex="1">
          <mxGeometry x="-280" y="-1040" width="340" height="110" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-11" value="&lt;b&gt;Word2vec&lt;/b&gt;&lt;div&gt;1)Skip-gram&lt;/div&gt;&lt;div&gt;从一预测附近&lt;/div&gt;&lt;div&gt;2)CBOW&lt;/div&gt;&lt;div&gt;从附近预测一&lt;/div&gt;&lt;div&gt;有两个词矩阵，不共享权重，方便优化，用的时候取一或平均&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" parent="1" vertex="1">
          <mxGeometry x="-640" y="-1040" width="350" height="110" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-13" value="&lt;b&gt;FastText&lt;/b&gt;&lt;br&gt;&lt;div&gt;1）where = &amp;lt;wh, whe, her, ere, re&amp;gt; 分拆成连续词袋训练&lt;/div&gt;&lt;div&gt;考虑了相近单词的语义相似&lt;/div&gt;&lt;div&gt;2）优点：&lt;/div&gt;&lt;div&gt;对低频词生成的词向量效果好，n-gram可以和其它词共享&lt;br&gt;&lt;/div&gt;&lt;div&gt;词库外的词仍然有可能进行词向量生成&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" parent="1" vertex="1">
          <mxGeometry x="-640" y="-1160" width="350" height="110" as="geometry" />
        </mxCell>
        <mxCell id="ATmWsD3FDVk_h2czRpAP-14" value="&lt;b&gt;Bert 动态词向量方法&amp;nbsp;&lt;/b&gt;Encoder模型&lt;br&gt;&lt;div&gt;&lt;font color=&quot;#0000cc&quot;&gt;预训练任务方面 Pre-training&lt;/font&gt;&lt;/div&gt;&lt;div&gt;1）MLM&lt;/div&gt;&lt;div&gt;输出是输入挖空的句子，&lt;span style=&quot;background-color: initial;&quot;&gt;预测[mask]，采用811混淆训练数据&lt;/span&gt;&lt;/div&gt;&lt;div&gt;2）NSP&lt;/div&gt;&lt;div&gt;输出50%是输入的下一句句子，预测是否是下一句&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000cc&quot;&gt;下游任务方面 Fine-tuning&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0000cc&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#990000&quot;&gt;Encode后的T1,T2,T3...即为所需的句子embedding（Token）&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" parent="1" vertex="1">
          <mxGeometry x="-280" y="-1210" width="340" height="160" as="geometry" />
        </mxCell>
        <mxCell id="H9xUbHL-VWyd2PXrm6Qb-2" value="&lt;b&gt;Rank 精排&lt;/b&gt;&lt;div&gt;&lt;b&gt;&lt;font color=&quot;#9933ff&quot;&gt;传统机器学习推荐模型&lt;/font&gt;&lt;br&gt;&lt;/b&gt;&lt;div&gt;1）FM 模型&lt;/div&gt;&lt;div&gt;解决稀疏特征数据的处理难点，引入了二阶特征组合&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2）FFM模型&lt;/div&gt;&lt;div&gt;引入了域的概念，提高了模型的表达能力&lt;/div&gt;&lt;div&gt;但是增加了模型参数量与复杂度，增加了计算开销&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3）GBDT+LR&amp;nbsp; （特征工程模型化）&lt;/div&gt;&lt;div&gt;利用GBDT筛选出特征组合，再输入LR进行预测，能够利用高阶关系&lt;/div&gt;&lt;div&gt;缺点为无法进行在线学习。需要提前进行GBDT的训练与特征组合提取&lt;/div&gt;&lt;div&gt;&lt;font color=&quot;#0066cc&quot;&gt;Facebook的经验：低频更新embedding网络，高频更新上层网络结构&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4）MLR&amp;nbsp; （分组＋聚合）&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;font color=&quot;#9933ff&quot;&gt;深度学习推荐模型&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1）WDL&amp;nbsp; （Wide &amp;amp; Deep Learning）&lt;/div&gt;&lt;/div&gt;&lt;div&gt;Wide 用于记忆，Deep 用于泛化&lt;/div&gt;&lt;div&gt;两个结构的优化器不一样，Wide采样FTLR(处理稀疏性)，Deep采用AdaGrad&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2）DCN&amp;nbsp; &amp;nbsp; （Deep&amp;amp;Cross Network）&lt;/div&gt;&lt;div&gt;将WDL模型的Wide部分替换为Cross网络，加强了特征信息的融合&lt;/div&gt;&lt;div&gt;Cross网络使用层层传递的形式，和零层相乘再乘以参数向量，加上偏置与残差&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3）DIN&amp;nbsp; &amp;nbsp; &amp;nbsp; （Deep Interest Network）&lt;/div&gt;&lt;div&gt;利用注意力机制动态编码用户向量&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4）&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" vertex="1" parent="1">
          <mxGeometry x="70" y="-920" width="630" height="580" as="geometry" />
        </mxCell>
        <mxCell id="H9xUbHL-VWyd2PXrm6Qb-4" value="&lt;b&gt;应用深度网络模型DCN/DeepFM/BST进行复购预测，对比了模型的结构与效果&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;align=left;verticalAlign=top;spacingLeft=4;" vertex="1" parent="1">
          <mxGeometry x="70" y="-330" width="450" height="110" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
